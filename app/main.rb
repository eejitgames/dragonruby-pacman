class PacMan
  attr_gtk

  def defaults
    @maze ||= [ # this is a 28 x 31 grid
    [ 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10 ],
    [ 10,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0, 10, 10,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0, 10 ],
    [ 10,  0, 10, 10, 10, 10,  0, 10, 10, 10, 10, 10,  0, 10, 10,  0, 10, 10, 10, 10, 10,  0, 10, 10, 10, 10,  0, 10 ],
    [ 10,  0, 10, 10, 10, 10,  0, 10, 10, 10, 10, 10,  0, 10, 10,  0, 10, 10, 10, 10, 10,  0, 10, 10, 10, 10,  0, 10 ],
    [ 10,  0, 10, 10, 10, 10,  0, 10, 10, 10, 10, 10,  0, 10, 10,  0, 10, 10, 10, 10, 10,  0, 10, 10, 10, 10,  0, 10 ],
    [ 10,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0, 10 ],
    [ 10,  0, 10, 10, 10, 10,  0, 10, 10,  0, 10, 10, 10, 10, 10, 10, 10, 10,  0, 10, 10,  0, 10, 10, 10, 10,  0, 10 ],
    [ 10,  0, 10, 10, 10, 10,  0, 10, 10,  0, 10, 10, 10, 10, 10, 10, 10, 10,  0, 10, 10,  0, 10, 10, 10, 10,  0, 10 ],
    [ 10,  0,  0,  0,  0,  0,  0, 10, 10,  0,  0,  0,  0, 10, 10,  0,  0,  0,  0, 10, 10,  0,  0,  0,  0,  0,  0, 10 ],
    [ 10, 10, 10, 10, 10, 10,  0, 10, 10, 10, 10, 10,  0, 10, 10,  0, 10, 10, 10, 10, 10,  0, 10, 10, 10, 10, 10, 10 ],
    [ 11, 11, 11, 11, 11, 10,  0, 10, 10, 10, 10, 10,  0, 10, 10,  0, 10, 10, 10, 10, 10,  0, 10, 11, 11, 11, 11, 11 ],
    [ 11, 11, 11, 11, 11, 10,  0, 10, 10,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0, 10, 10,  0, 10, 11, 11, 11, 11, 11 ],
    [ 11, 11, 11, 11, 11, 10,  0, 10, 10,  0, 10, 10, 10, 12, 12, 10, 10, 10,  0, 10, 10,  0, 10, 11, 11, 11, 11, 11 ],
    [ 10, 10, 10, 10, 10, 10,  0, 10, 10,  0, 10, 11, 11, 11, 11, 11, 11, 10,  0, 10, 10,  0, 10, 10, 10, 10, 10, 10 ],
    [  0,  0,  0,  0,  0,  0,  0,  0,  0,  0, 10, 11, 11, 11, 11, 11, 11, 10,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0 ],
    [ 10, 10, 10, 10, 10, 10,  0, 10, 10,  0, 10, 11, 11, 11, 11, 11, 11, 10,  0, 10, 10,  0, 10, 10, 10, 10, 10, 10 ],
    [ 11, 11, 11, 11, 11, 10,  0, 10, 10,  0, 10, 10, 10, 10, 10, 10, 10, 10,  0, 10, 10,  0, 10, 11, 11, 11, 11, 11 ],
    [ 11, 11, 11, 11, 11, 10,  0, 10, 10,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0, 10, 10,  0, 10, 11, 11, 11, 11, 11 ],
    [ 11, 11, 11, 11, 11, 10,  0, 10, 10,  0, 10, 10, 10, 10, 10, 10, 10, 10,  0, 10, 10,  0, 10, 11, 11, 11, 11, 11 ],
    [ 10, 10, 10, 10, 10, 10,  0, 10, 10,  0, 10, 10, 10, 10, 10, 10, 10, 10,  0, 10, 10,  0, 10, 10, 10, 10, 10, 10 ],
    [ 10,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0, 10, 10,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0, 10 ],
    [ 10,  0, 10, 10, 10, 10,  0, 10, 10, 10, 10, 10,  0, 10, 10,  0, 10, 10, 10, 10, 10,  0, 10, 10, 10, 10,  0, 10 ],
    [ 10,  0, 10, 10, 10, 10,  0, 10, 10, 10, 10, 10,  0, 10, 10,  0, 10, 10, 10, 10, 10,  0, 10, 10, 10, 10,  0, 10 ],
    [ 10,  0,  0,  0, 10, 10,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0, 10, 10,  0,  0,  0, 10 ],
    [ 10, 10, 10,  0, 10, 10,  0, 10, 10,  0, 10, 10, 10, 10, 10, 10, 10, 10,  0, 10, 10,  0, 10, 10,  0, 10, 10, 10 ],
    [ 10, 10, 10,  0, 10, 10,  0, 10, 10,  0, 10, 10, 10, 10, 10, 10, 10, 10,  0, 10, 10,  0, 10, 10,  0, 10, 10, 10 ],
    [ 10,  0,  0,  0,  0,  0,  0, 10, 10,  0,  0,  0,  0, 10, 10,  0,  0,  0,  0, 10, 10,  0,  0,  0,  0,  0,  0, 10 ],
    [ 10,  0, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10,  0, 10, 10,  0, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10,  0, 10 ],
    [ 10,  0, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10,  0, 10, 10,  0, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10,  0, 10 ],
    [ 10,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0, 10 ],
    [ 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10 ],        
  ].reverse
  end

  def draw_background
    outputs.background_color = [ 0, 0, 0 ]
  end

  def draw_maze
    31.times do |y|
      28.times do |x|
        if @maze[y][x] == 10
          outputs.solids << [ (x + 28) * 16, (y + 7) * 16, 16, 16, 30, 30, 255 ]
        end
        if @maze[y][x] == 12
          outputs.solids << [ (x + 28) * 16, (y + 7) * 16, 16, 16, 255, 180, 255 ]
        end
      end
    end      
  end

  def tick
    defaults
    draw_background
    draw_maze
  end
end

def tick args
  if args.tick_count.zero?
    puts "set $game to nil"
    $game = nil
  end
  $game ||= PacMan.new
  $game.args = args
  $game.tick
end

$gtk.reset